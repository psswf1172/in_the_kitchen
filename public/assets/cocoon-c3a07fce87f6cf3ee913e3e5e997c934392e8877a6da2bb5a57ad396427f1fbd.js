!function(g){var e=0,m=function(){return(new Date).getTime()+e++},_=function(e){return"["+e+"]$1"},h=function(e){return"_"+e+"_$1"},w=function(e,n,t){return e?"function"==typeof e?(n&&console.warn("association-insertion-traversal is ignored, because association-insertion-node is given as a function."),e(t)):"string"==typeof e?n?t[n](e):"this"==e?t:g(e):void 0:t.parent()};g(document).on("click",".add_fields",function(e){e.preventDefault();var n=g(this),t=n.data("association"),a=n.data("associations"),i=n.data("association-insertion-template"),o=n.data("association-insertion-method")||n.data("association-insertion-position")||"before",r=n.data("association-insertion-node"),s=n.data("association-insertion-traversal"),c=parseInt(n.data("count"),10),d=new RegExp("\\[new_"+t+"\\](.*?\\s)","g"),u=new RegExp("_new_"+t+"_(\\w*)","g"),l=m(),f=i.replace(d,_(l)),p=[];for(f==i&&(d=new RegExp("\\[new_"+a+"\\](.*?\\s)","g"),u=new RegExp("_new_"+a+"_(\\w*)","g"),f=i.replace(d,_(l))),p=[f=f.replace(u,h(l))],c=isNaN(c)?1:Math.max(c,1),c-=1;c;)l=m(),f=(f=i.replace(d,_(l))).replace(u,h(l)),p.push(f),c-=1;var v=w(r,s,n);v&&0!=v.length||console.warn("Couldn't find the element to insert the template. Make sure your `data-association-insertion-*` on `link_to_add_association` is correct."),g.each(p,function(e,n){var t=g(n),a=jQuery.Event("cocoon:before-insert");if(v.trigger(a,[t]),!a.isDefaultPrevented()){v[o](t);v.trigger("cocoon:after-insert",[t])}})}),g(document).on("click",".remove_fields.dynamic, .remove_fields.existing",function(e){var n=g(this),t=n.data("wrapper-class")||"nested-fields",a=n.closest("."+t),i=a.parent();e.preventDefault();var o=jQuery.Event("cocoon:before-remove");if(i.trigger(o,[a]),!o.isDefaultPrevented()){var r=i.data("remove-timeout")||0;setTimeout(function(){n.hasClass("dynamic")?a.remove():(n.prev("input[type=hidden]").val("1"),a.hide()),i.trigger("cocoon:after-remove",[a])},r)}}),g(document).on("ready page:load turbolinks:load",function(){g(".remove_fields.existing.destroyed").each(function(){var e=g(this),n=e.data("wrapper-class")||"nested-fields";e.closest("."+n).hide()})})}(jQuery);